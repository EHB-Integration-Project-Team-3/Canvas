name: CI Pipeline Canvas
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:

    runs-on: ubuntu-20.04
    
    steps:
    - uses: actions/checkout@v2
    - name: Setup .NET
      uses: actions/setup-dotnet@v1
      with:
        dotnet-version: 3.1.x
    - name: Restore dependencies
      run: dotnet restore
    - name: Build
      run: dotnet build --no-restore
    - name: Test
      run: dotnet test --no-restore --verbosity normal
    - name: Docker Login
      uses: docker/login-action@v1.9.0
      with:
        username: ${{secrets.DOCKER_USERNAME}}
        password: ${{secrets.DOCKER_PASSWORD}}
    - name: Docker Setup Buildx
  # You may pin to the exact commit or the version.
  # uses: docker/setup-buildx-action@0d135e0c2fc0dba0729c1a47ecfcf5a3c7f8579e
      uses: docker/setup-buildx-action@v1.3.0
        
    - name: Build and push Docker images
      uses: docker/build-push-action@v2.5.0
      with:
        #context: ./
        file: ./dockerfile
        push: true
        #repository: sonergezgen/myreposoner
        tags: latest
        
        
      
    #- name: Connect VPN
      #uses: actions/checkout@v1
   # - name: Install Open VPN
   #   run: sudo apt-get install openvpn
   #- name: Connect EhB VPN
    #  uses: golfzaptw/action-connect-ovpn@master
    #  id: EhB_VPN
    #  with:
     #     PING_URL: dtsslvpn.ehb.be
    #      #FILE_OVPN: '.github/vpn/config.ovpn'
          #SECRET: ${{ secrets.SECRET_USERNAME_PASSWORD }}
      #    TLS_KEY: ly600aq7jdtrG4U2s5eY
      #env:
          #CA_CRT: ${{ secrets.CA_CRT}}
          #USER_CRT: ${{ secrets.USER_CRT }}
          #USER_KEY: ${{ secrets.USER_KEY }}
    #- name: Check Connect VPN
      #run: echo ${{ steps.connect_vpn.outputs.STATUS }}
        
   # - name: Deploy and test ssh connection
   #   uses: appleboy/ssh-action@master
   #   with:
    #    host: 10.3.17.67
    #    username: canvas
   #     #password: sdf765SDF
   #     key: ${{secrets.canvas_private_key}}
   #     port: 22
        #passphrase: ${{secrets.passphrase_private_key}}
        #description: passphrase is used for encrypt the data between two points.
        #args: "-tt"
     #   debug: true
     #   script: |
     #     cd CanvasApp
     #    git pull origin master
      #    git status
          
    
      

